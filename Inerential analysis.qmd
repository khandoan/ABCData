---
title: "Inferential Statistics"
format: html
editor: visual
---

```{r setup, include=FALSE, echo=TRUE, fig.width=8, fig.height=6, fig.show='hold'}
#install.packages("dplyr")
#install.packages("knitr")
#install.packages("ggplot2")
#install.packages("agricolae")


library(dplyr)
library(knitr)
library(ggplot2)
library(agricolae)
```

## ANOVA

When you click the **Render** button a document will be generated that includes both content and the output of embedded code. You can embed code like this:

```{r}
data <- data.frame(frutasysemillas)

# Remove rows with missing Nseeds
data_clean <- na.omit(data[, c("Treatment", "Block", "Nseeds")])

# Perform ANOVA
anova_result <- aov(Nseeds ~ Treatment + Block, data = data_clean)
summary(anova_result)


tukey_result <- TukeyHSD(anova_result)
tukey_result

agricolae_result <- HSD.test(anova_result, "Treatment", group = TRUE)
print(agricolae_result$groups)
```

## Shapiro Test

```{r}
group_counts_nseeds <- data_clean %>%
  group_by(Treatment) %>%
  summarise(unique_count = n_distinct(Nseeds))

# Filter out treatments with only one unique value in 'Nseeds'
data_filtered_nseeds <- data_clean %>%
  filter(Treatment %in% group_counts_nseeds$Treatment[group_counts_nseeds$unique_count > 1])

# Perform the Shapiro-Wilk test on filtered data
shapiro_result_nseeds <- data_filtered_nseeds %>%
  group_by(Treatment) %>%
  summarise(p_value = shapiro.test(Nseeds)$p.value)

# Print the results
print(shapiro_result_nseeds)
# Plot the histogram and QQ plot again
ggplot(data_filtered_nseeds, aes(x = Nseeds)) +
  geom_histogram(bins = 30, fill = "blue", alpha = 0.7) +
  facet_wrap(~ Treatment) +
  theme_minimal() +
  labs(title = "Histogram of Number of Seeds",
       x = "Number of Seeds (Nseeds)",
       y = "Frequency")

ggplot(data_filtered_nseeds, aes(sample = Nseeds)) +
  stat_qq() +
  stat_qq_line() +
  facet_wrap(~ Treatment) +
  theme_minimal() +
  labs(title = "QQ Plot by Treatment")

```

## Kruskal-Wallis Test

```{r}
data_clean <- na.omit(data[, c("Treatment", "Nseeds")])

# Perform Kruskal-Wallis test
kruskal_test <- kruskal.test(Nseeds ~ Treatment, data = data_clean)
print(kruskal_test)

# Perform post-hoc analysis using agricolae package (e.g., Dunn's test or HSD test)
library(agricolae)
agricolae_result <- kruskal(data_clean$Nseeds, data_clean$Treatment, group = TRUE)

# Extract group labels and prepare for plotting
group_labels <- agricolae_result$groups
group_labels$Treatment <- rownames(group_labels) # Match 'Treatment' column
group_labels$y_position <- 2
group_labels <- group_labels %>%
  mutate(y_position = aggregate(Nseeds ~ Treatment, data = data_clean, max)$Nseeds + 5) # Position text above boxplots

# Plot the boxplot with group labels
library(ggplot2)
ggplot(data_clean, aes(x = Treatment, y = Nseeds)) +
  geom_boxplot() +
  theme_minimal() +
  labs(title = "Boxplot of Number of Seeds by Treatment (Non-parametric)",
       x = "Treatment",
       y = "Number of Seeds") +
  geom_text(data = group_labels, 
            aes(x = Treatment, 
                y = y_position, 
                label = groups), 
            color = "red", size = 5) +
  theme(
    plot.caption = element_text(hjust = 0.5) # Center-align the caption
  )
```
